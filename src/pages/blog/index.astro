---
import { getCollection } from 'astro:content'
import BlogCard from '../../components/BlogCard.astro'
import BaseLayout from '../../layouts/BaseLayout.astro'

const posts = (
	await getCollection('blog', ({ data }) => data.draft !== true)
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())

// Blog structured data
const blogSchema = {
	'@context': 'https://schema.org',
	'@type': 'Blog',
	name: 'HideLog',
	description:
		'やりたいことをやりたいようにやってみる。ダイビング、筋トレ、コード、家族と暮らしの挑戦ログ。',
	url: new URL('/blog/', Astro.site).toString(),
	author: {
		'@type': 'Person',
		name: 'Hidekazu Wada',
		url: 'https://blog.wadahide.com/about',
	},
	publisher: {
		'@type': 'Organization',
		name: 'HideLog',
		logo: {
			'@type': 'ImageObject',
			url: new URL('/logo.svg', Astro.site).toString(),
		},
	},
	blogPost: posts.slice(0, 10).map((post) => ({
		'@type': 'BlogPosting',
		headline: post.data.title,
		description: post.data.description,
		url: new URL(`/blog/${post.slug}/`, Astro.site).toString(),
		datePublished: post.data.pubDate.toISOString(),
		dateModified: post.data.updatedDate
			? post.data.updatedDate.toISOString()
			: post.data.pubDate.toISOString(),
	})),
}

// BreadcrumbList structured data
const breadcrumbSchema = {
	'@context': 'https://schema.org',
	'@type': 'BreadcrumbList',
	itemListElement: [
		{
			'@type': 'ListItem',
			position: 1,
			name: 'Home',
			item: Astro.site?.toString() || '',
		},
		{
			'@type': 'ListItem',
			position: 2,
			name: 'Blog',
			item: new URL('/blog/', Astro.site).toString(),
		},
	],
}
---

<BaseLayout title="Blog">
	<script type="application/ld+json" set:html={JSON.stringify(blogSchema)} />
	<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
	<main class="app-container pt-36">
		<h1 class="text-6xl pb-8 font-bold">Blog</h1>
		<p class="md:w-2/3 text-lg leading-[2rem]">
			Welcome to my blog! Here you'll find a collection of my thoughts and
			experiences. I hope you enjoy reading them as much as I enjoy writing
			them.
		</p>
	</main>
	<section class="app-container py-12">
		<ul class="posts-grid-container">
			{
				posts.map((post) => (
					<li>
						<BlogCard post={post} />
					</li>
				))
			}
		</ul>
	</section>
</BaseLayout>
